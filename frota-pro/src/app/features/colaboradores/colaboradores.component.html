<div class="colab-page">
  <h2 class="page-title">Colaboradores</h2>

  <div class="search-box">
    <input
      type="text"
      placeholder="Pesquisar por nome ou código..."
      [(ngModel)]="searchTerm"
    />
  </div>

  <!-- MOTORISTAS -->
  <section class="colab-block">
    <div class="block-header">
      <h3>Motoristas</h3>
      <span class="count">{{ filterList(motoristas).length }}</span>
    </div>

    <ul class="colab-list">
      <li *ngFor="let m of filterList(motoristas); trackBy: trackById" class="colab-item">
        <button class="row" type="button" (click)="toggleExpand('motorista', m.id)">
          <div class="left">
            <span class="codigo">{{ m.codigo }}</span>
            <span class="nome">{{ m.nome }}</span>
          </div>
          <div class="right">
            <span class="role">Motorista</span>
            <i
              class="fas"
              [ngClass]="{
                'fa-chevron-down': !isExpanded('motorista', m.id),
                'fa-chevron-up': isExpanded('motorista', m.id)
              }"
            ></i>
          </div>
        </button>

        <div class="expand-container" [class.expanded]="isExpanded('motorista', m.id)">
          <div class="details">
            <div class="detail-row"><strong>Código:</strong> {{ m.codigo }}</div>
            <div class="detail-row" *ngIf="m.codigoExterno"><strong>Código Externo:</strong> {{ m.codigoExterno }}</div>
            <div class="detail-row" *ngIf="m.email"><strong>E-mail:</strong> {{ m.email }}</div>
            <div class="detail-row" *ngIf="m.dataNascimento"><strong>Data Nasc.:</strong> {{ m.dataNascimento | date : 'dd/MM/yyyy' }}</div>
            <div class="detail-row" *ngIf="m.cnh"><strong>CNH:</strong> {{ m.cnh }}</div>
            <div class="detail-row" *ngIf="m.validadeCnh"><strong>Validade CNH:</strong> {{ m.validadeCnh | date : 'dd/MM/yyyy' }}</div>
            <div class="detail-row"><strong>Status:</strong> {{ m.status }}</div>
            <div class="detail-row"><strong>Ativo:</strong> {{ m.ativo ? 'Sim' : 'Não' }}</div>
          </div>
        </div>
      </li>
    </ul>
  </section>

  <!-- MECÂNICOS -->
  <section class="colab-block">
    <div class="block-header">
      <h3>Mecânicos</h3>
      <span class="count">{{ filterList(mecanicos).length }}</span>
    </div>

    <ul class="colab-list">
      <li *ngFor="let me of filterList(mecanicos); trackBy: trackById" class="colab-item">
        <button class="row" type="button" (click)="toggleExpand('mecanico', me.id)">
          <div class="left">
            <span class="codigo">{{ me.codigo }}</span>
            <span class="nome">{{ me.nome }}</span>
          </div>
          <div class="right">
            <span class="role">Mecânico</span>
            <i
              class="fas"
              [ngClass]="{
                'fa-chevron-down': !isExpanded('mecanico', me.id),
                'fa-chevron-up': isExpanded('mecanico', me.id)
              }"
            ></i>
          </div>
        </button>

        <div class="expand-container" [class.expanded]="isExpanded('mecanico', me.id)">
          <div class="details">
            <div class="detail-row"><strong>Código:</strong> {{ me.codigo }}</div>
            <div class="detail-row"><strong>Nome:</strong> {{ me.nome }}</div>
            <div class="detail-row" *ngIf="me.oficina"><strong>Oficina:</strong> {{ me.oficina.nome }}</div>
            <div class="detail-row"><strong>Ativo:</strong> {{ me.ativo ? 'Sim' : 'Não' }}</div>
          </div>
        </div>
      </li>
    </ul>
  </section>

  <!-- AJUDANTES (com CRUD local) -->
  <section class="colab-block">
    <div class="block-header" style="align-items: center;">
      <h3 style="margin: 0;">Ajudantes</h3>

      <div style="display:flex; align-items:center; gap:12px;">
        <span class="count">{{ filterList(ajudantes).length }}</span>
        <!-- botão adicionar -->
        <button class="btn-add" type="button" (click)="abrirFormularioAjudante()">+ Ajudante</button>
      </div>
    </div>

    <ul class="colab-list">
      <li *ngFor="let a of filterList(ajudantes); trackBy: trackById" class="colab-item">
        <button class="row" type="button" (click)="toggleExpand('ajudante', a.id)">
          <div class="left">
            <span class="codigo">{{ a.codigo }}</span>
            <span class="nome">{{ a.nome }}</span>
          </div>
          <div class="right">
            <span class="role">Ajudante</span>
            <i
              class="fas"
              [ngClass]="{
                'fa-chevron-down': !isExpanded('ajudante', a.id),
                'fa-chevron-up': isExpanded('ajudante', a.id)
              }"
            ></i>
          </div>
        </button>

        <div class="expand-container" [class.expanded]="isExpanded('ajudante', a.id)">
          <div class="details">
            <div class="detail-row"><strong>Código:</strong> {{ a.codigo }}</div>
            <div class="detail-row" *ngIf="a.codigoExterno"><strong>Código Externo:</strong> {{ a.codigoExterno }}</div>
            <div class="detail-row"><strong>Nome:</strong> {{ a.nome }}</div>
            <div class="detail-row"><strong>Status:</strong> {{ a.status }}</div>
            <div class="detail-row"><strong>Ativo:</strong> {{ a.ativo ? 'Sim' : 'Não' }}</div>

            <!-- botões de ação para ajudantes -->
            <div class="action-buttons" style="margin-top:10px;">
              <button class="btn-edit" (click)="editarAjudante(a); $event.stopPropagation()">Editar</button>
              <button class="btn-delete" (click)="excluirAjudante(a.id); $event.stopPropagation()">Excluir</button>
            </div>
          </div>
        </div>
      </li>
    </ul>
  </section>

  <!-- MODAL / FORMULÁRIO PARA AJUDANTE -->
  <div class="modal-overlay" *ngIf="showAjudanteModal">
    <div class="modal-box" role="dialog" aria-modal="true">
      <div class="modal-title">{{ novoAjudante?.id ? 'Editar Ajudante' : 'Novo Ajudante' }}</div>

      <div class="modal-form">
        <label>Código</label>
        <input type="text" [(ngModel)]="novoAjudante.codigo" />

        <label>Código Externo</label>
        <input type="text" [(ngModel)]="novoAjudante.codigoExterno" />

        <label>Nome</label>
        <input type="text" [(ngModel)]="novoAjudante.nome" />

        <label>Status</label>
        <select [(ngModel)]="novoAjudante.status">
          <option value="DISPONIVEL">Disponível</option>
          <option value="EM_SERVICO">Em serviço</option>
          <option value="DESATIVADO">Desativado</option>
        </select>

        <label>
          <input type="checkbox" [(ngModel)]="novoAjudante.ativo" />
          Ativo
        </label>

        <div class="modal-actions">
          <button class="btn-save" (click)="salvarAjudante()">Salvar</button>
          <button class="btn-cancel" (click)="cancelarAjudante()">Cancelar</button>
        </div>
      </div>
    </div>
  </div>
</div>
