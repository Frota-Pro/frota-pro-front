<div class="page">
  <div class="page-header">
    <div class="left">
      <h1>Caminh√µes</h1>
      <p>Gerencie sua frota: cadastro, edi√ß√£o, filtros e status.</p>
    </div>

    <div class="right">
      <button class="btn primary" type="button" (click)="openAddModal()">
        + Novo caminh√£o
      </button>
    </div>
  </div>

  <!-- ALERTAS -->
  <div class="alerts" *ngIf="errorMsg">
    <div class="alert error">
      <span class="dot"></span>
      <div class="content">
        <strong>Ops!</strong>
        <div>{{ errorMsg }}</div>
      </div>
    </div>
  </div>

  <!-- TOOLBAR -->
  <div class="toolbar">
    <div class="search">
      <span class="icon">üîé</span>
      <input
        type="text"
        [(ngModel)]="search"
        placeholder="Buscar por placa, descri√ß√£o, marca, modelo, c√≥digo, categoria..."
      />
    </div>

    <div class="filters">
      <div class="field">
        <label>Status</label>
        <select [(ngModel)]="statusFilter">
          <option *ngFor="let s of statusOpcoes" [ngValue]="s.value">
            {{ s.label }}
          </option>
        </select>
      </div>

      <div class="field">
        <label>Ativo</label>
        <select [(ngModel)]="ativoFilter">
          <option [ngValue]="'ATIVOS'">Ativos</option>
          <option [ngValue]="'INATIVOS'">Inativos</option>
          <option [ngValue]="'TODOS'">Todos</option>
        </select>
      </div>

      <div class="field">
        <label>Por p√°gina</label>
        <select [ngModel]="size" (ngModelChange)="setPageSize($event)">
          <option [ngValue]="10">10</option>
          <option [ngValue]="20">20</option>
          <option [ngValue]="50">50</option>
        </select>
      </div>

      <button class="btn ghost" type="button" (click)="carregarPagina()">
        Atualizar
      </button>
    </div>
  </div>

  <!-- RESUMO -->
  <div class="summary">
    <div class="pill">
      <strong>{{ totalElements }}</strong>&nbsp; registros (API)
    </div>
    <div class="pill">
      <strong>{{ filtered.length }}</strong>&nbsp; exibidos (filtros)
    </div>
    <div class="pill">
      P√°gina <strong>{{ page + 1 }}</strong> de <strong>{{ totalPages || 1 }}</strong>
    </div>
  </div>

  <!-- LOADING -->
  <div class="loading" *ngIf="loading">
    <div class="spinner"></div>
    <span>Carregando...</span>
  </div>

  <!-- LISTA -->
  <div class="table-wrap" *ngIf="!loading">
    <table class="table" *ngIf="filtered.length > 0; else emptyState">
      <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Placa</th>
        <th>Descri√ß√£o</th>
        <th>Marca / Modelo</th>
        <th>Categoria</th>
        <th>Licenciamento</th>
        <th>Status</th>
        <th class="col-actions">A√ß√µes</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let c of filtered">
        <td>
          <div class="code">
            <span class="mono">{{ c.codigo }}</span>
            <small *ngIf="c.codigoExterno" class="muted">Ext: {{ c.codigoExterno }}</small>
          </div>
        </td>

        <td>
          <span class="plate">{{ c.placa }}</span>
        </td>

        <td>
          <div class="desc">
            <strong>{{ c.descricao }}</strong>
            <small class="muted" *ngIf="c.cor">Cor: {{ c.cor }}</small>
          </div>
        </td>

        <td>
          <div class="mm">
            <strong>{{ c.marca }}</strong>
            <small class="muted">{{ c.modelo }}</small>
          </div>
        </td>

        <td>
          <div class="cat">
              <span class="tag" *ngIf="c.categoriaCodigo; else semCategoria">
                {{ c.categoriaDescricao || c.categoriaCodigo }}
              </span>
            <ng-template #semCategoria>
              <span class="muted">‚Äî</span>
            </ng-template>
          </div>
        </td>

        <td>
          <span>{{ c.dtLicenciamento || '‚Äî' }}</span>
        </td>

        <td>
            <span class="badge" [ngClass]="badgeClass(c)">
              {{ statusLabel(c.status || '') }}
              <span class="muted" *ngIf="!c.ativo"> ‚Ä¢ Inativo</span>
            </span>
        </td>

        <td class="actions">
          <button class="btn small" type="button" (click)="openEditModal(c)">
            Editar
          </button>
          <button class="btn small danger" type="button" (click)="excluir(c)">
            Inativar
          </button>
        </td>
      </tr>
      </tbody>
    </table>

    <ng-template #emptyState>
      <div class="empty">
        <div class="icon">üöö</div>
        <h3>Nenhum caminh√£o encontrado</h3>
        <p>Tente ajustar os filtros ou cadastre um novo caminh√£o.</p>
        <button class="btn primary" type="button" (click)="openAddModal()">
          + Cadastrar caminh√£o
        </button>
      </div>
    </ng-template>
  </div>

  <!-- PAGINA√á√ÉO -->
  <div class="pagination" *ngIf="!loading && totalPages > 0">
    <button class="btn ghost" type="button" (click)="prevPage()" [disabled]="page <= 0">
      ‚óÄ Anterior
    </button>

    <div class="page-info">
      P√°gina <strong>{{ page + 1 }}</strong> de <strong>{{ totalPages }}</strong>
    </div>

    <button
      class="btn ghost"
      type="button"
      (click)="nextPage()"
      [disabled]="page + 1 >= totalPages"
    >
      Pr√≥xima ‚ñ∂
    </button>
  </div>

  <!-- MODAL -->
  <div class="modal-backdrop" *ngIf="showModal" (click)="closeModal()"></div>

  <div class="modal" *ngIf="showModal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="title">
        <h2>{{ isEditing ? 'Editar caminh√£o' : 'Novo caminh√£o' }}</h2>
        <p class="muted">
          Preencha os dados abaixo. Campos com <span class="req">*</span> s√£o obrigat√≥rios.
        </p>
      </div>

      <button class="icon-btn" type="button" (click)="closeModal()" aria-label="Fechar">
        ‚úï
      </button>
    </div>

    <div class="modal-body">
      <div class="grid">
        <div class="field">
          <label>C√≥digo (somente leitura)</label>
          <input type="text" [value]="form.codigo || '‚Äî'" disabled />
        </div>

        <div class="field">
          <label>C√≥digo externo</label>
          <input type="text" [(ngModel)]="form.codigoExterno" placeholder="Ex: WIN-00123" />
        </div>

        <div class="field span-2">
          <label>Descri√ß√£o <span class="req">*</span></label>
          <input type="text" [(ngModel)]="form.descricao" placeholder="Ex: Caminh√£o Ba√∫ 3/4" />
        </div>

        <div class="field">
          <label>Marca <span class="req">*</span></label>
          <input type="text" [(ngModel)]="form.marca" placeholder="Ex: Volvo" />
        </div>

        <div class="field">
          <label>Modelo <span class="req">*</span></label>
          <input type="text" [(ngModel)]="form.modelo" placeholder="Ex: FH 540" />
        </div>

        <div class="field">
          <label>Placa <span class="req">*</span></label>
          <input type="text" [(ngModel)]="form.placa" placeholder="Ex: ABC1D23" />
        </div>

        <div class="field">
          <label>Cor</label>
          <input type="text" [(ngModel)]="form.cor" placeholder="Ex: Branco" />
        </div>

        <div class="field">
          <label>Categoria</label>
          <select [(ngModel)]="form.categoriaCodigo">
            <option value="">‚Äî Selecione ‚Äî</option>
            <option *ngFor="let cat of categorias" [value]="cat.codigo">
              {{ cat.descricao }} ({{ cat.codigo }})
            </option>
          </select>
          <small class="hint">
            O back espera o <strong>c√≥digo</strong> da categoria (ex: <span class="mono">CARRETA</span>).
          </small>
        </div>

        <div class="field">
          <label>Data de licenciamento</label>
          <input type="date" [(ngModel)]="form.dtLicenciamentoISO" />
        </div>

        <div class="divider"></div>

        <div class="field">
          <label>ANTT</label>
          <input type="text" [(ngModel)]="form.antt" placeholder="Registro ANTT" />
        </div>

        <div class="field">
          <label>Renavan</label>
          <input type="text" [(ngModel)]="form.renavan" placeholder="Renavan" />
        </div>

        <div class="field span-2">
          <label>Chassi</label>
          <input type="text" [(ngModel)]="form.chassi" placeholder="Chassi" />
        </div>

        <div class="field">
          <label>Tara (kg)</label>
          <input type="text" [(ngModel)]="form.tara" placeholder="Ex: 7800" />
        </div>

        <div class="field">
          <label>Peso m√°ximo (kg)</label>
          <input type="text" [(ngModel)]="form.maxPeso" placeholder="Ex: 23000" />
        </div>
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn ghost" type="button" (click)="closeModal()">
        Cancelar
      </button>

      <button class="btn primary" type="button" (click)="salvar()" [disabled]="loading">
        {{ loading ? 'Salvando...' : (isEditing ? 'Salvar altera√ß√µes' : 'Cadastrar caminh√£o') }}
      </button>
    </div>
  </div>
</div>
