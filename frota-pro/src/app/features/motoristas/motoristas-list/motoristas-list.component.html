<div class="page">

  <div class="header">
    <div>
      <h1>Motoristas</h1>
      <p>Pesquise por c√≥digo interno, c√≥digo externo, CNH e gerencie cadastros.</p>
    </div>

    <div class="actions">
      <button class="btn primary" type="button" (click)="openNovoMotorista()">+ Novo motorista</button>
    </div>
  </div>

  <div class="toolbar">
    <input class="search"
           [(ngModel)]="codigoInterno"
           (keyup.enter)="page=0; carregarPagina()"
           placeholder="C√≥digo interno (ex: MOT-000123)" />

    <input class="search"
           [(ngModel)]="codigoExterno"
           (keyup.enter)="page=0; carregarPagina()"
           placeholder="C√≥digo externo (ERP/WinThor)" />

    <input class="search"
           [(ngModel)]="cnh"
           (keyup.enter)="page=0; carregarPagina()"
           placeholder="CNH" />

    <input class="search"
           [(ngModel)]="nomeEmail"
           (keyup.enter)="page=0; carregarPagina()"
           placeholder="Nome/E-mail" />

    <select [(ngModel)]="ativoFilter" class="select">
      <option [ngValue]="'ATIVOS'">Ativos</option>
      <option [ngValue]="'INATIVOS'">Inativos</option>
      <option [ngValue]="'TODOS'">Todos</option>
    </select>

    <button class="btn ghost" type="button" (click)="carregarPagina()">Atualizar</button>
  </div>

  <div class="alert" *ngIf="errorMsg">{{ errorMsg }}</div>

  <div class="table-wrap" *ngIf="!loading; else loadingTpl">
    <table class="table" *ngIf="filtered.length > 0; else emptyTpl">
      <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Nome</th>
        <th>CNH</th>
        <th>E-mail</th>
        <th>C√≥d. Externo</th>
        <th>Status</th>
        <th class="col-actions">A√ß√µes</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let m of filtered" (dblclick)="abrirDetalhe(m)">
        <td class="mono">{{ m.codigo }}</td>

        <td>
          <div class="stack">
            <strong>{{ m.nome }}</strong>
            <small class="muted" *ngIf="m.dataNascimento">Nasc: {{ m.dataNascimento }}</small>
          </div>
        </td>

        <td class="mono">{{ m.cnh }}</td>

        <td>
          <div class="stack">
            <strong>{{ m.email }}</strong>
            <small class="muted" *ngIf="m.validadeCnh">Validade CNH: {{ m.validadeCnh }}</small>
          </div>
        </td>

        <td class="mono">{{ m.codigoExterno || '‚Äî' }}</td>

        <td>
          <span class="status" [class.inactive]="!m.ativo">{{ m.ativo ? 'ATIVO' : 'INATIVO' }}</span>
        </td>

        <td class="row-actions" (click)="$event.stopPropagation()">
          <button class="btn small" type="button" (click)="abrirDetalhe(m)">Ver</button>

          <button *ngIf="m.ativo" class="btn small danger" type="button" (click)="inativar(m)">
            Inativar
          </button>

          <button *ngIf="!m.ativo" class="btn small" type="button" (click)="ativar(m)">
            Ativar
          </button>
        </td>
      </tr>
      </tbody>
    </table>

    <ng-template #emptyTpl>
      <div class="empty">
        <div class="icon">üßë‚Äç‚úàÔ∏è</div>
        <h3>Nenhum motorista encontrado</h3>
        <p>Cadastre um motorista ou ajuste os filtros.</p>
      </div>
    </ng-template>

    <div class="pagination" *ngIf="totalPages > 0">
      <button class="btn ghost" (click)="prevPage()" [disabled]="page <= 0">‚óÄ</button>
      <div class="pageinfo">P√°gina {{ page + 1 }} de {{ totalPages }}</div>
      <button class="btn ghost" (click)="nextPage()" [disabled]="page + 1 >= totalPages">‚ñ∂</button>
    </div>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>
  </ng-template>

  <!-- MODAL MOTORISTA -->
  <div class="backdrop" *ngIf="showMotoristaModal" (click)="closeMotoristaModal()"></div>
  <div class="modal" *ngIf="showMotoristaModal">
    <div class="modal-header">
      <h2>Novo motorista</h2>
      <button class="icon" (click)="closeMotoristaModal()">‚úï</button>
    </div>

    <div class="modal-body">
      <label>Nome</label>
      <input [(ngModel)]="form.nome" placeholder="Ex: JO√ÉO SILVA" />

      <label>E-mail</label>
      <input [(ngModel)]="form.email" placeholder="Ex: joao@empresa.com" />

      <label>C√≥digo Externo</label>
      <input [(ngModel)]="form.codigoExterno" placeholder="Ex: 12345 (WinThor)" />

      <label>Data de Nascimento (dd/MM/yyyy)</label>
      <input [(ngModel)]="form.dataNascimento" placeholder="Ex: 29/12/1995" />

      <label>CNH</label>
      <input [(ngModel)]="form.cnh" placeholder="Ex: 01234567890" />

      <label>Validade CNH (dd/MM/yyyy)</label>
      <input [(ngModel)]="form.validadeCnh" placeholder="Ex: 29/12/2030" />
    </div>

    <div class="modal-footer">
      <button class="btn ghost" (click)="closeMotoristaModal()">Cancelar</button>
      <button class="btn primary" (click)="salvarMotorista()">Salvar</button>
    </div>
  </div>
</div>
