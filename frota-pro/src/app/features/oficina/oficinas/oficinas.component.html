<div class="page">

  <div class="header">
    <div>
      <h1>Oficinas</h1>
      <p>Cadastre oficinas e acesse o dashboard com custos e or√ßamentos.</p>
    </div>

    <div class="actions">
      <button class="btn primary" type="button" (click)="openNova()">+ Nova oficina</button>
    </div>
  </div>

  <div class="toolbar">
    <input class="search"
           [(ngModel)]="search"
           (ngModelChange)="applyLocalFilter()"
           placeholder="Buscar por c√≥digo ou nome..." />

    <button class="btn ghost" type="button" (click)="carregarPagina()">Atualizar</button>
  </div>

  <div class="alert" *ngIf="errorMsg">{{ errorMsg }}</div>

  <div class="table-wrap" *ngIf="!loading; else loadingTpl">
    <table class="table" *ngIf="filtered.length > 0; else emptyTpl">
      <thead>
      <tr>
        <th>C√≥digo</th>
        <th>Nome</th>
        <th class="col-actions">A√ß√µes</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let o of filtered" (dblclick)="abrirDetalhe(o)">
        <td class="mono">{{ o.codigo }}</td>
        <td><strong>{{ o.nome }}</strong></td>

        <td class="row-actions" (click)="$event.stopPropagation()">
          <button class="btn small" type="button" (click)="abrirDetalhe(o)">Dashboard</button>
          <button class="btn small" type="button" (click)="openEditar(o)">Editar</button>
          <button class="btn small danger" type="button" (click)="deletar(o)">Excluir</button>
        </td>
      </tr>
      </tbody>
    </table>

    <ng-template #emptyTpl>
      <div class="empty">
        <div class="icon">üè≠</div>
        <h3>Nenhuma oficina encontrada</h3>
        <p>Cadastre uma oficina para come√ßar.</p>
      </div>
    </ng-template>

    <div class="pagination" *ngIf="totalPages > 0">
      <button class="btn small" [disabled]="page<=0" (click)="carregarPagina(page-1)">Anterior</button>
      <span class="pageinfo">P√°gina {{ page + 1 }} de {{ totalPages }}</span>
      <button class="btn small" [disabled]="page+1>=totalPages" (click)="carregarPagina(page+1)">Pr√≥xima</button>
    </div>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">
      <div class="spinner"></div>
      <div>Carregando oficinas...</div>
    </div>
  </ng-template>

  <!-- MODAL -->
  <div class="backdrop" *ngIf="showModal" (click)="closeModal()"></div>

  <div class="modal" *ngIf="showModal">
    <div class="modal-header">
      <h2>{{ isEditing ? 'Editar oficina' : 'Nova oficina' }}</h2>
      <button class="icon" type="button" (click)="closeModal()">‚úï</button>
    </div>

    <div class="modal-body">
      <label>Nome</label>
      <input [(ngModel)]="form.nome" placeholder="Ex.: Oficina Central" />
    </div>

    <div class="modal-footer">
      <button class="btn" type="button" (click)="closeModal()">Cancelar</button>
      <button class="btn primary" type="button" (click)="salvar()">Salvar</button>
    </div>
  </div>

</div>
