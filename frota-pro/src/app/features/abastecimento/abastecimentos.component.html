<div class="abaste-page">
  <!-- HEAD -->
  <div class="page-head">
    <div class="titles">
      <h2 class="page-title">Abastecimentos</h2>
      <div class="subtitle">Controle de combust√≠vel da frota</div>
    </div>

    <div class="actions">
      <button class="btn-add" (click)="openAddModal()">+ Adicionar Abastecimento</button>
    </div>
  </div>

  <!-- CARDS -->
  <div class="cards-row">
    <div class="card">
      <div class="card-icon">üõ¢Ô∏è</div>
      <div class="card-info">
        <div class="card-title">Litros (m√™s)</div>
        <div class="card-value">{{ litersThisMonth | number : '1.0-3' }}</div>
      </div>
    </div>

    <div class="card">
      <div class="card-icon">üí∏</div>
      <div class="card-info">
        <div class="card-title">Gasto total</div>
        <div class="card-value">{{ totalSpent | currency : 'BRL' }}</div>
      </div>
    </div>

    <div class="card">
      <div class="card-icon">‚öñÔ∏è</div>
      <div class="card-info">
        <div class="card-title">Pre√ßo m√©dio (R$/L)</div>
        <div class="card-value">{{ avgPricePerLiter | number : '1.2-3' }}</div>
      </div>
    </div>

    <div class="card">
      <div class="card-icon">üöö</div>
      <div class="card-info">
        <div class="card-title">Consumo m√©dio (km/L)</div>
        <div class="card-value">{{ avgConsumption | number : '1.2-2' }}</div>
      </div>
    </div>
  </div>

  <!-- FILTROS -->
  <div class="filters-row">
    <!-- Pesquisar geral -->
    <input type="text" placeholder="Pesquisar geral..." [(ngModel)]="searchTerm" />

    <!-- Tipo combust√≠vel -->
    <select [(ngModel)]="filtroTipo">
      <option value="">Todos combust√≠veis</option>
      <option value="DIESEL">Diesel</option>
      <option value="DIESEL_S10">Diesel S10</option>
      <option value="GASOLINA">Gasolina</option>
      <option value="ETANOL">Etanol</option>
      <option value="GNV">GNV</option>
    </select>

    <!-- Datas -->
    <label class="date-inline">
      <span>De</span>
      <input type="date" [(ngModel)]="filtroDataInicio" />
    </label>

    <label class="date-inline">
      <span>At√©</span>
      <input type="date" [(ngModel)]="filtroDataFim" />
    </label>
  </div>

  <!-- LISTA -->
  <section class="list-block">
    <div class="block-header">
      <h3>Abastecimentos</h3>
      <span class="count">{{ abastecimentosFiltrados.length }}</span>
    </div>

    <!-- CABE√áALHO -->
    <div class="list-header">
      <span>Data</span>
      <span>Caminh√£o</span>
      <span>Motorista</span>
      <span>Combust√≠vel</span>
      <span>Litros</span>
      <span>Valor</span>
      <span>Posto</span>
      <span>A√ß√µes</span>
    </div>

    <!-- ITENS -->
    <ul class="abaste-list">
      <li *ngFor="let a of abastecimentosFiltrados; trackBy: trackById" class="abaste-item">
        <!-- Linha principal -->
        <div class="row" (click)="toggleExpand(a.id)">
          <span>{{ a.dtAbastecimento | date : 'dd/MM/yyyy HH:mm' }}</span>
          <span>{{ a.caminhao?.placa || a.caminhao?.codigo }}</span>
          <span>{{ a.motorista?.nome || '‚Äî' }}</span>
          <span>{{ a.tipoCombustivel }}</span>
          <span>{{ a.qtLitros | number : '1.0-3' }}</span>
          <span>{{ a.valorTotal | currency : 'BRL' }}</span>
          <span>{{ a.posto }}</span>

          <!-- A√ß√µes -->
          <div class="row-actions">
            <button class="btn-edit" (click)="openEditModal(a); $event.stopPropagation()">
              ‚úèÔ∏è
            </button>
            <button
              class="btn-delete"
              (click)="deleteAbastecimento(a.id); $event.stopPropagation()"
            >
              üóëÔ∏è
            </button>
          </div>
        </div>

        <!-- EXPANDIDO -->
        <div class="expand-container" [class.expanded]="isExpanded(a.id)">
          <div class="details">
            <div><strong>C√≥digo:</strong> {{ a.codigo }}</div>
            <div><strong>Caminh√£o:</strong> {{ a.caminhao?.placa }}</div>
            <div><strong>Motorista:</strong> {{ a.motorista?.nome }}</div>
            <div><strong>Kilometragem:</strong> {{ a.kmOdometro }}</div>
            <div><strong>Valor por litro:</strong> {{ a.valorLitro }}</div>
            <div><strong>Forma pagamento:</strong> {{ a.formaPagamento }}</div>
            <div><strong>Local:</strong> {{ a.posto }} ‚Äî {{ a.cidade }}/{{ a.uf }}</div>
            <div *ngIf="a.numNotaOuCupom"><strong>Cupom:</strong> {{ a.numNotaOuCupom }}</div>
            <div *ngIf="a.mediaKmLitro"><strong>Km/L:</strong> {{ a.mediaKmLitro }}</div>
          </div>
        </div>
      </li>
    </ul>
  </section>

  <!-- MODAL ADicionar -->
<div class="modal-overlay" *ngIf="showAddModal">
  <div class="modal-card">

    <h3>Novo Abastecimento</h3>

    <div class="modal-form">

      <label>C√≥digo</label>
      <input type="text" [(ngModel)]="novo.codigo" />

      <label>Data / Hora</label>
      <input type="datetime-local" [(ngModel)]="novo.dtAbastecimento" />

      <label>Caminh√£o (placa)</label>
      <input type="text" [(ngModel)]="novo.caminhao.placa" />

      <label>Motorista</label>
      <input type="text" [(ngModel)]="novo.motorista.nome" />

      <label>Tipo Combust√≠vel</label>
      <select [(ngModel)]="novo.tipoCombustivel">
        <option value="DIESEL">Diesel</option>
        <option value="DIESEL_S10">Diesel S10</option>
        <option value="GASOLINA">Gasolina</option>
        <option value="ETANOL">Etanol</option>
        <option value="GNV">GNV</option>
      </select>

      <label>Litros</label>
      <input type="number" step="0.001" [(ngModel)]="novo.qtLitros" />

      <label>Valor por litro</label>
      <input type="number" step="0.001" [(ngModel)]="novo.valorLitro" />

      <label>Valor total</label>
      <input type="number" step="0.01" [(ngModel)]="novo.valorTotal" />

      <label>Posto</label>
      <input type="text" [(ngModel)]="novo.posto" />

      <div class="modal-actions">
        <button class="btn-save" (click)="saveAbastecimento()">Salvar</button>
        <button class="btn-cancel" (click)="closeAddModal()">Cancelar</button>
      </div>

    </div>

  </div>
</div>

</div>
