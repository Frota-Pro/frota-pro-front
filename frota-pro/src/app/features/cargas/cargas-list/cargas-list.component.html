<div class="page">

  <!-- TOASTS -->
  <div class="toast-wrap" aria-live="polite" aria-atomic="true">
    <div class="toast"
         *ngFor="let t of toasts"
         [class.success]="t.type === 'success'"
         [class.error]="t.type === 'error'"
         [class.info]="t.type === 'info'">
      <div class="toast-left">
        <div class="toast-title" *ngIf="t.title">{{ t.title }}</div>
        <div class="toast-msg">{{ t.message }}</div>
      </div>
      <button class="toast-x" type="button" (click)="dismissToast(t.id)">âœ•</button>
    </div>
  </div>

  <div class="header">
    <div>
      <h1>Cargas</h1>
      <p>Pesquise por cÃ³digo interno/externo e por perÃ­odo de saÃ­da.</p>
    </div>

    <div class="actions">
      <button class="btn ghost" type="button" (click)="carregarPagina()">Atualizar</button>
      <button class="btn" type="button" (click)="limparFiltros()">Limpar</button>
    </div>
  </div>

  <div class="toolbar">
    <input class="search"
           [(ngModel)]="q"
           (keyup.enter)="aplicarFiltros()"
           placeholder="Buscar por cÃ³digo interno/externo..." />

    <div class="periodo">
      <label>
        <span>InÃ­cio</span>
        <input type="date" [(ngModel)]="inicio" />
      </label>
      <label>
        <span>Fim</span>
        <input type="date" [(ngModel)]="fim" />
      </label>
      <button class="btn primary" type="button" (click)="aplicarFiltros()">Pesquisar</button>
    </div>
  </div>

  <div class="alert" *ngIf="periodoErro">{{ periodoErro }}</div>
  <div class="alert" *ngIf="errorMsg">{{ errorMsg }}</div>

  <div class="table-wrap" *ngIf="!loading; else loadingTpl">
    <table class="table" *ngIf="rows.length > 0; else emptyTpl">
      <thead>
      <tr>
        <th>NÃºmero</th>
        <th>Motorista</th>
        <th>CaminhÃ£o</th>
        <th>SaÃ­da</th>
        <th>Valor</th>
        <th>Status</th>
        <th class="col-actions">AÃ§Ãµes</th>
      </tr>
      </thead>

      <tbody>
      <tr *ngFor="let c of rows" (dblclick)="abrirDetalhe(c)">
        <td>
          <div class="stack">
            <strong class="mono">{{ c.numeroCarga }}</strong>
            <small class="muted" *ngIf="c.numeroCargaExterno">Ext: {{ c.numeroCargaExterno }}</small>
          </div>
        </td>

        <td class="muted">{{ c.nomeMotorista || 'â€”' }}</td>
        <td class="plate">{{ c.placaCaminhao || 'â€”' }}</td>
        <td>{{ c.dtSaida ? (c.dtSaida | date:'dd/MM/yyyy') : 'â€”' }}</td>
        <td>{{ formatMoneyBRL(c.valorTotal) }}</td>
        <td>
          <span class="badge">{{ labelStatus(c.statusCarga) }}</span>
        </td>
        <td class="row-actions" (click)="$event.stopPropagation()">
          <button class="btn small" type="button" (click)="abrirDetalhe(c)">Ver</button>
        </td>
      </tr>
      </tbody>
    </table>

    <ng-template #emptyTpl>
      <div class="empty">
        <div class="icon">ðŸšš</div>
        <h3>Nenhuma carga encontrada</h3>
        <p>Altere os filtros ou tente outro perÃ­odo.</p>
      </div>
    </ng-template>

    <div class="pagination" *ngIf="totalPages > 0">
      <button class="btn ghost" (click)="prevPage()" [disabled]="page <= 0">â—€</button>
      <div class="pageinfo">PÃ¡gina {{ page + 1 }} de {{ totalPages }}</div>
      <button class="btn ghost" (click)="nextPage()" [disabled]="page + 1 >= totalPages">â–¶</button>
    </div>
  </div>

  <ng-template #loadingTpl>
    <div class="loading">
      <div class="spinner"></div>
      <span>Carregando...</span>
    </div>
  </ng-template>

</div>
